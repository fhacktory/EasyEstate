// Generated by CoffeeScript 1.7.1
(function() {
  var Advert, AdvertCollection, AdvertView, AppView, SettingView, Settings;

  $(function() {
    var app, collection, map;
    console.log("START EASYESTATE");
    map = L.map('map').setView([45.7505, 4.8409], 13);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
      maxZoom: 18
    }).addTo(map);
    collection = new AdvertCollection;
    return app = new AppView({
      collection: collection
    });
  });

  Advert = Backbone.Model.extend({
    defaults: function() {
      return {
        title: 'No title',
        size: 0,
        link: '',
        price: 0,
        city: '',
        zipcode: '',
        address: '',
        pictures: []
      };
    },
    initialize: function() {}
  });

  AdvertCollection = Backbone.Firebase.Collection.extend({
    model: Advert,
    url: '//fiery-fire-2189.firebaseio.com/adverts'
  });

  Settings = Backbone.Model.extend({
    defaults: function() {
      return {
        size: 0,
        bar: false,
        restaurant: false,
        cafe: false,
        bicycle_rental: false,
        coworking_space: false
      };
    },
    initialize: function() {}
  });

  AdvertView = Backbone.View.extend({
    tagName: 'tr',
    template: _.template("<td><img class='img-responsive' src='<%= pictures[0] %>'/></td> <td><%= title %></td> <td><%= size %></td> <td><%= link %></td> <td><%= price %></td> <td><%= city %></td> <td><%= zipcode %></td>"),
    initialize: function() {
      this.listenTo(this.model, 'change', this.render);
    },
    render: function() {
      this.$el.html(this.template(this.model.toJSON()));
      return this;
    }
  });

  AppView = Backbone.View.extend({
    el: $('#app'),
    initialize: function() {
      this.table = $("#adverts-table");
      this.listenTo(this.collection, 'add', this.addOne);
    },
    addOne: function(ad) {
      var view;
      view = new AdvertView({
        model: ad
      });
      this.table.append(view.render().el);
    }
  });

  SettingView = Backbone.View.extend({
    el: $('#app'),
    initialize: function() {
      this.table = $("#adverts-table");
      this.listenTo(this.collection, 'add', this.addOne);
    },
    addOne: function(ad) {
      var view;
      view = new AdvertView({
        model: ad
      });
      this.table.append(view.render().el);
    }
  });

  AdvertView = Backbone.View.extend({
    tagName: 'tr',
    template: _.template("<td><a href='<%= link %>'><img class='img-responsive' src='<%= pictures[0] %>' /></a></td> <td><%= title %></td> <td><%= size %></td> <td><%= price %></td> <td><%= city %></td> <td><%= zipcode %></td>"),
    initialize: function() {
      this.listenTo(this.model, 'change', this.render);
    },
    render: function() {
      this.$el.html(this.template(this.model.toJSON()));
      return this;
    }
  });

}).call(this);
